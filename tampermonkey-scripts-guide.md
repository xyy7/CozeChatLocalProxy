# Coze Chat Tampermonkey 脚本使用指南

## 脚本版本说明

### 1. 基础增强版 (`coze-chat-tampermonkey-enhanced.js`)
- **版本**: 1.1
- **特点**: 包含详细的调试信息、错误处理和用户友好的控制台输出
- **适用场景**: 大多数网站，无严格CSP限制的环境
- **权限要求**: 基础权限，无需特殊grant

### 2. 专业版 (`coze-chat-tampermonkey-pro.js`) 
- **版本**: 2.0
- **特点**: 包含CSP绕过功能、代理支持、重试机制和高级调试
- **适用场景**: 有严格CSP限制的网站（如MSN）
- **权限要求**: 需要额外的GM权限支持跨域请求

## 安装步骤

### 方法一：直接安装
1. 安装 Tampermonkey 浏览器扩展
2. 点击 Tampermonkey 图标 → "创建新脚本"
3. 复制脚本内容粘贴到编辑器中
4. 保存脚本（Ctrl+S）

### 方法二：从文件安装
1. 下载脚本文件到本地
2. 在 Tampermonkey 中点击"实用工具"
3. 选择"文件"标签 → "导入"
4. 选择下载的脚本文件

## 功能对比

| 功能 | 基础版 | 专业版 |
|------|--------|--------|
| 基本注入 | ✅ | ✅ |
| 详细调试信息 | ✅ | ✅ |
| 错误处理 | ✅ | ✅ |
| CSP绕过 | ❌ | ✅ |
| 代理支持 | ❌ | ✅ |
| 重试机制 | ❌ | ✅ |
| 跨域请求 | ❌ | ✅ |
| 桌面通知 | ❌ | ✅ |
| 自动重试 | ❌ | ✅ |

## 控制台输出示例

### 成功注入
```
✅ Coze SDK 加载成功
🎉 Coze 聊天组件初始化成功
✅ 聊天组件准备就绪
```

### 遇到CSP限制
```
❌ Coze SDK 直接加载失败
🔍 分析可能的CSP限制...
🔄 尝试代理 1/4 (尝试 1/3)
✅ 代理加载成功
```

### 完全失败
```
💥 所有注入方法都失败了
🛠️ 最终解决方案建议:
1. 检查浏览器控制台的详细错误信息
2. 禁用所有广告拦截和隐私保护扩展
```

## 故障排除

### 常见问题

1. **脚本不生效**
   - 检查 Tampermonkey 是否启用
   - 确认脚本匹配的URL模式正确
   - 查看浏览器控制台错误信息

2. **CSP限制错误**
   - 使用专业版脚本
   - 禁用广告拦截器
   - 尝试无痕模式

3. **网络连接问题**
   - 检查网络连接
   - 尝试不同的代理服务

### 调试技巧

1. **查看详细日志**
   - 打开浏览器开发者工具（F12）
   - 切换到 Console 标签页
   - 查看以 🔧, ✅, ❌ 开头的日志消息

2. **监控网络请求**
   - 在 Network 标签页查看脚本加载状态
   - 检查是否有被阻止的请求

3. **检查CSP策略**
   - 在 Console 中查看 CSP 相关错误
   - 在 Network 标签页查看响应头中的 CSP 策略

## 自定义配置

### 修改Bot配置
```javascript
const CONFIG = {
    BOT_ID: '你的Bot_ID',
    TITLE: '自定义标题',
    SDK_URL: 'SDK链接',
    // ... 其他配置
};
```

### 调整超时时间
```javascript
const CONFIG = {
    TIMEOUT: 20000, // 20秒超时
    RETRY_ATTEMPTS: 5 // 5次重试
};
```

### 添加自定义代理
```javascript
const PROXY_SERVICES = [
    'https://your-proxy.com/',
    'https://cors-anywhere.herokuapp.com/',
    // ... 其他代理
];
```

## 安全注意事项

1. **Token安全**
   - 不要公开分享包含token的脚本
   - 定期更新访问token

2. **代理服务**
   - 选择可信的代理服务
   - 避免使用不安全的代理

3. **浏览器权限**
   - 仅授予必要的权限
   - 定期审查脚本权限

## 更新维护

### 版本更新
- 定期检查SDK版本更新
- 更新脚本中的SDK链接
- 测试新版本的兼容性

### 故障报告
遇到问题时提供以下信息：
1. 浏览器版本
2. 脚本版本
3. 控制台错误信息
4. 网络标签页截图

## 技术支持

如需技术支持，请提供：
- 详细的错误信息
- 浏览器控制台输出
- 网络请求截图
- 页面URL信息

---

**注意**: 使用脚本前请确保遵守目标网站的使用条款和服务协议。