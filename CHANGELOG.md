# Coze Chat Tampermonkey 脚本更新日志

## [2.1.1] - 2025-09-02

### 修复
- **本地代理URL构造问题**: 修复了本地代理服务器URL构造格式不匹配的问题
  - 之前：使用查询参数格式 `http://127.0.0.1:8080/?url=https://example.com`
  - 现在：使用路径格式 `http://127.0.0.1:8080/https://example.com`
  - 原因：代理服务器代码优先检查路径格式，查询参数格式作为备选

- **代理功能验证**: 改进了本地代理可用性检查逻辑
  - 之前：只检查HTTP 200状态码
  - 现在：同时验证响应内容包含预期的测试数据（httpbin.org）
  - 确保代理不仅响应，而且实际工作正常

### 技术细节
1. **代理服务器兼容性**: 
   - 代理服务器支持两种URL格式：
     - 路径格式: `/https://example.com/api`
     - 查询参数格式: `/?url=https://example.com/api`
   - 路径格式是首选，查询参数格式作为备选方案

2. **错误处理改进**:
   - 当本地代理检测成功时，脚本将优先使用本地代理
   - 只有在本地代理真正不可用时才会回退到外部代理
   - 减少了不必要的代理切换和重试

### 测试验证
- 创建了测试脚本 `test_local_proxy.js` 验证代理功能
- 创建了HTML测试页面 `test_proxy.html` 用于浏览器测试
- 确保本地代理和外部代理都能正常工作

## [2.1.0] - 2025-09-01

### 新增
- 初始版本发布
- 支持本地CORS代理服务器
- 多代理服务备选方案
- 详细的日志和错误处理
- 智能代理模式选择

### 功能
- ✅ 本地代理优先策略
- ✅ 外部代理备选方案  
- ✅ 详细的调试日志
- ✅ 智能错误处理和重试
- ✅ CSP绕过支持